user
note
show

<body>
	<% if @note.user == current_user %>
		これはあなたが投稿したNoteです。
		<%= link_to 'Noteを編集する', edit_note_path(@note) %>
		<%= link_to 'Noteを削除する', notes_path, method: :delete, data: { confirm: 'Are you sure?' } %><!--論理削除-->
	<% end %>

	<div>
		<p><%= @note.is_browsable_guest %></p><br><!--左上にオシャレに表示、無料＝青、有料＝黄色、ポイント＝金 -->

		<p><%= @note.view_point %></p><br>
	</div>
	<div>
		<p><%= @note.title %></p><br>
		<p><%= render_with_hashtags(@note.overview) %></p><br>


		<!--- 選択したハッシュタグを表示-->



<!--以下モデルに書くべき？　モデルで定義=>本文タグ内をモザイク画像に置き換え＆リンクを貼る　ビューで定義=>JSでモザイク加工あるはず
そもそも考え方としてNoteの性質（モデル）？それとも表示条件（ビュー）？

	if 無料記事
		表示

	elseif 有料記事（ポイント0に限る）

		if 有料会員、投稿者、admin
			=>表示
		else
			=>モザイク
		end


	else 有料記事（ポイント１以上）

		if 有料会員で購入済、投稿者、admin
			=>表示
		else
			=>モザイク
		end

	end
-->
		<p><%= @note.content %></p><br><!--モザイク処理の上に購入かどうか書きたいのでリンクは一旦保留-->

		<% @postscripts.each do |postscript| %>
		<%= postscript.review.user.name %>さんのレビュー(<%= postscript.review.created_at %>)に対する追記<br>
		<%= postscript.postscript %><br>
		<%= postscript.created_at %><br>
		<% end %>


	</div>

	<div><br><br><br>
		レビュー<br>
		<% @reviews.each do |review| %>
			<%= link_to review.user.name, user_path(review.user) %><br>
			<%= review.created_at %>
			<%= review.quality %><br>
			<%= review.review %><br>
			<% if review.is_appending == "追記を希望する" %>
			このレビューは追記を希望しています。<br>
				<% if @note.user == current_user %>
				<%= link_to "希望内容を追記する", note_review_path(@note, review) %>
				<% end %>
			<% elsif review.is_appending == "希望した追記にリアクション済み" %>
				このレビューの追記希望にリアクション済みです。<br>
			<% else %>
			<% end %>
			<br>

		<% end %>

	</div>


	<div>

						<!--ログインの確認=> 投稿者の確認=> ブックマーク追加済みか否かの確認-->
	<!--ユーザーがログインしているかの確認-->
	<% if user_signed_in? %>

		<!--投稿者の確認-->
		<% if @note.user == current_user %><!--閲覧中のNoteが自分の投稿である場合)-->
			<%= link_to 'Noteを編集する', edit_note_path(@note) %>
			<%= link_to 'Noteを削除する', notes_path, method: :delete, data: { confirm: 'Are you sure?' } %><!--論理削除-->
		<% else %><!--閲覧中のNoteが他人の投稿である場合-->

			<%= form_for ([@note, @review]) do |f| %>
				<%= f.hidden_field :note_id, value: @note.id, require: true %>
				<%= f.hidden_field :user_id, value: current_user.id, require: true %>
				<%= f.number_field :quality %><br>
				<%= f.text_field :review %><br>
				<%= f.radio_button :is_appending, :"追記を希望しない" %> 追記を希望しない
  				<%= f.radio_button :is_appending, :"追記を希望する" %> 追記を希望する<br>
  	 			<%= f.submit 'レビューする' %><!--create前にログイン促す-->
			<% end %>


			<% if @bookmarks.exists?(note_id: @note.id) %><!--ユーザーがブックマーク追加済み-->
			bookmark済み
			<% else %><!--ブックマークに追加していない-->
				<%= form_for(@bookmark) do |f| %>
					<%= f.hidden_field :note_id, value: @note.id %>
					<%= f.hidden_field :user_id, value: current_user.id %>
					<%= f.submit "Bookmarkに追加" %>
				<% end %>
			<% end %>

		<% end %>

	<% else %><!--ログインしていないユーザーの処理-->
		<%= link_to "Bookmarkに追加", new_user_session_path %><!--routing確認新規登録が望ましい-->

	<% end %>
	</div>


</body>